<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.ustb.softverify.mapper.SoftInfoDAO">
    
    <resultMap id="UserSoftInfoResult" type="com.ustb.softverify.entity.vo.SoftInfoVo">
        <result property="softName" column="soft_name"/>
        <result property="softDesc" column="soft_desc"/>
        <result property="status" column="status"/>
        <result property="govUserId" column="gov_user_id"/>
        <result property="sid" column="sid"/>
        <collection property="signFileList" resultMap="signFileListMap"/>
    </resultMap>

    <resultMap id="signFileListMap" type="FileRecord">
        <result property="serverLocalName" column="server_local_name"/>
    </resultMap>

    <select id="getUploadInfo" resultMap="UserSoftInfoResult">
        select s.soft_name, s.soft_desc, s.status,s.gov_user_id,s.sid, f.server_local_name
         from t_soft s, sys_file_record f
        where  s.gov_user_id = f.gov_user_id and s.gov_user_id = #{govUserId} and s.status = 3
    </select>

    <select id="getUnFiledSoftInfo" resultMap="UserSoftInfoResult">
        select s.soft_name, s.soft_desc, s.status, s.gov_user_id, f.server_local_name
         from  t_soft s, sys_file_record f
        where s.gov_user_id = f.gov_user_id and s.status = 2
    </select>

    <select id="getAllUploadInfo" resultMap="UserSoftInfoResult">
    select s.soft_name, s.soft_desc, s.status, s.gov_user_id,s.sid from t_soft s where s.status = 3
</select>
    
    <select id="SignFileInfos" resultType="com.ustb.softverify.entity.dto.SignFileInfo">
        select server_local_name, server_local_path from sys_file_record
        where gov_user_id=#{govUserId}
    </select>

    <select id="listSoft"  resultType="com.ustb.softverify.entity.po.SoftInfo">
        select * from t_soft where gov_user_id=#{govUserId}
    </select>


    <insert id="insertSoft" >
        insert into t_soft (soft_name,soft_desc,status,gov_user_id) values (#{softName},#{softDesc},0,#{govUserId})
    </insert>

    <update id="updateSoft" >
        update t_soft set soft_name=#{softName},soft_desc=#{softDesc} where sid=#{sid}
    </update>


    <select id="findSoftName" resultType="String">
        select soft_name from t_soft
        where gov_user_id = #{govUserId} and status = 2
    </select>

    <update id="changeStatus" >
        update t_soft set status = 3
        where gov_user_id = #{govUserId} and status = 2
    </update>

    <select id="findSoftId" resultType="Integer">
        select sid from t_soft
        where gov_user_id = #{govUserId} and status = 2
    </select>

    <insert id="insertSignFile">
        insert into t_signfile (file_name,txid,sid) values (#{fileName},#{txid},#{sid});
    </insert>

    <select id="getTxid" resultType="SignFile" >
        select * from t_signfile where sid = #{sid}
    </select>

    <select id="getSoftInfo" resultType="SoftInfo">
        select * from t_soft where sid = #{sid};
    </select>

    <update id="updateStatus" >
        update t_soft set status=#{status}+1 where gov_user_id=#{govUserId} and status=#{status}
    </update>

    <update id="insertPath">
        update t_soft set soft_remote_path = #{path},zip_name = #{zipName}
        where soft_name = #{softName}
    </update>



</mapper>